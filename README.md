# üè¶ Bank REST API

–ù–∞–¥—ë–∂–Ω—ã–π RESTful‚Äë–±—ç–∫–µ–Ω–¥ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –Ω–∞ **Spring Boot 3.5**, **Spring Security JWT**, **PostgreSQL** –∏ **Liquibase**.  
–†–µ–∞–ª–∏–∑—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∫–∞—Ä—Ç–∞–º–∏, –ø–µ—Ä–µ–≤–æ–¥—ã, –∞ —Ç–∞–∫–∂–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –∑–∞–¥–∞–Ω–∏–µ–º.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-----------|
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | JWT‚Äë–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è ¬∑ –†–æ–ª–µ–≤–∞—è –º–æ–¥–µ–ª—å (USER / ADMIN) ¬∑ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –∫–∞—Ä—Ç (PAN) |
| **–ë–∏–∑–Ω–µ—Å‚Äë–ª–æ–≥–∏–∫–∞** | CRUD‚Äë–æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–∞—Ä—Ç–∞–º–∏ ¬∑ –ü–µ—Ä–µ–≤–æ–¥—ã –º–µ–∂–¥—É —Å–≤–æ–∏–º–∏ –∫–∞—Ä—Ç–∞–º–∏ ¬∑ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ / –∞–∫—Ç–∏–≤–∞—Ü–∏—è ¬∑ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è |
| **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∫–∞—Ä—Ç–∞–º–∏ ¬∑ –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∑–∞–ø–∏—Å—è–º |
| **–•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö** | PostgreSQL + –º–∏–≥—Ä–∞—Ü–∏–∏ Liquibase |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | Swagger UI / OpenAPI 3 —Å –∫–Ω–æ–ø–∫–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ JWT |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è** | Bean Validation + —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ |
| **–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ** | Docker Compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥—ã —Å PostgreSQL |

---

## ‚öôÔ∏è –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### ‚Ññ1 –ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –ü–û
- JDK¬†17+  
- Docker¬†Desktop¬†–∏–ª–∏¬†Docker¬†Compose¬†v2  
- Maven¬†3.9+

### ‚Ññ2 –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
git clone https://github.com/yourusername/Bank-REST-Api.git
cd Bank-REST-Api
```

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª¬†`.env`¬†–¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ (–ø—Ä–∏–º–µ—Ä):

```env
DB_URL=jdbc:postgresql://localhost:5432/bank_db
DB_USER=postgres
DB_PASS=yourpassword
JWT_SECRET_B64=qD7ziVx+/xeythX9dM8OHGZnxI86t2Rq6Hvs6+w2N3c=
ATTRIBUTE_AES_KEY_B64=h8q7jZfF3e5eR3KM4gQ2rQ==
SERVER_PORT=8080
```

### ‚Ññ3 –ó–∞–ø—É—Å–∫ PostgreSQL —á–µ—Ä–µ–∑¬†Docker
```bash
docker compose up -d
```
–ó–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä¬†`postgres:18`¬†—Å –±–∞–∑–æ–π¬†`bank_db`.

### ‚Ññ4 –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
mvn spring-boot:run
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É¬†**http://localhost:8080**.

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

Swagger¬†UI —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π¬†**Springdoc¬†2.8.13**.

| –†–µ—Å—É—Ä—Å | URL |
|---------|-----|
| Swagger¬†UI | [http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html) |
| OpenAPI¬†JSON | [http://localhost:8080/v3/api-docs](http://localhost:8080/v3/api-docs) |
| OpenAPI¬†YAML | [http://localhost:8080/v3/api-docs.yaml](http://localhost:8080/v3/api-docs.yaml) |

–ï—Å–ª–∏ –≤¬†`application.yml`¬†–∑–∞–¥–∞–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É—Ç—å:
```yaml
springdoc:
  swagger-ui:
    path: /docs
```
—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ¬†[http://localhost:8080/docs/index.html](http://localhost:8080/docs/index.html).

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è¬†JWT
1. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω¬†—á–µ—Ä–µ–∑¬†`POST¬†/auth/login`.  
2. –ù–∞–∂–º–∏—Ç–µ¬†**Authorize**¬†–≤¬†Swagger¬†UI.  
3. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω¬†(–±–µ–∑¬†`Bearer`)¬†–∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ.

---

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö¬†(Liquibase)

–í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤  
`src/main/resources/db/changelog/`.

Liquibase –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.  
–î–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:
```bash
mvn liquibase:update
```

---

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–∞¬†OpenAPI

–î–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `docs/openapi.yaml`:
```bash
# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–æ
mvn -DskipTests=false verify
```
–ü–ª–∞–≥–∏–Ω¬†**springdoc-openapi-maven-plugin**¬†–æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `/v3/api-docs`  
–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é¬†YAML¬†–≤¬†`docs/openapi.yaml`¬†(–Ω—É–∂–Ω–æ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å).

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
 ‚îú‚îÄ main/java/com/example/bankcards/
 ‚îÇ   ‚îú‚îÄ config/           # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, JWT, OpenAPI
 ‚îÇ   ‚îú‚îÄ controller/       # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã Auth, User, Card
 ‚îÇ   ‚îú‚îÄ dto/              # DTO‚Äë–æ–±—ä–µ–∫—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤
 ‚îÇ   ‚îú‚îÄ entity/           # JPA‚Äë—Å—É—â–Ω–æ—Å—Ç–∏
 ‚îÇ   ‚îú‚îÄ repository/       # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ Spring¬†Data
 ‚îÇ   ‚îú‚îÄ service/          # –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π
 ‚îÇ   ‚îî‚îÄ exception/        # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
 ‚îú‚îÄ main/resources/
 ‚îÇ   ‚îú‚îÄ db/changelog/     # –ú–∏–≥—Ä–∞—Ü–∏–∏ Liquibase
 ‚îÇ   ‚îî‚îÄ application.yml   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–ë–î, JWT, Swagger)
 ‚îî‚îÄ test/java/...         # –Æ–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç—ã (–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
```

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –†–æ–ª—å | Endpoint | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|------------|
| Public | `POST /auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| Public | `POST /auth/login` | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ JWT |
| USER | `GET /cards/me` | –°–ø–∏—Å–æ–∫ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π) |
| USER | `POST /cards/me/create` | –°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—É |
| USER | `POST /cards/me/transfers` | –ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É —Å–≤–æ–∏–º–∏ –∫–∞—Ä—Ç–∞–º–∏ |
| USER | `PATCH /cards/me/{id}/request-block` | –ó–∞–ø—Ä–æ—Å–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –∫–∞—Ä—Ç—ã |
| ADMIN | `GET /cards` | –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –∫–∞—Ä—Ç |
| ADMIN | `POST /cards/users/{userId}/create` | –°–æ–∑–¥–∞—Ç—å –∫–∞—Ä—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é |
| ADMIN | `PATCH /cards/{id}/block` | –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É |
| ADMIN | `PATCH /cards/{id}/activate` | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É |
| ADMIN | `DELETE /cards/{id}` | –£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç—É |
| ADMIN | `GET /users` | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| ADMIN | `PUT /users/{id}` | –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| ADMIN | `DELETE /users/{id}` | –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```java
.requestMatchers(
  "/auth/**",
  "/v3/api-docs/**",
  "/v3/api-docs.yaml",
  "/swagger-ui.html",
  "/swagger-ui/**",
  "/docs/**"
).permitAll()
.anyRequest().authenticated();
```
–§–∏–ª—å—Ç—Ä¬†`JwtAuthenticationFilter`¬†–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç —ç—Ç–∏ –ø—É—Ç–∏,  
–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫¬†`Authorization:¬†Bearer¬†<token>`.

---

## Docker¬†Compose (–ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î)

```yaml
version: '3.9'
services:
  db:
    image: postgres:18
    container_name: bank_db
    restart: always
    environment:
      POSTGRES_DB: bank_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: t4040657
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data
volumes:
  pgdata:
```

---

## –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–æ–≤—ã—Ö –æ—à–∏–±–æ–∫

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏—á–∏–Ω–∞ / —Ä–µ—à–µ–Ω–∏–µ |
|-----------|------------------|
| `{"reason":"No static resource docs"}` | –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `springdoc-openapi-starter-webmvc-ui` –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π –ø—É—Ç—å¬†‚Üí —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å¬†**2.8.13**¬†–∏ —Ä–∞–∑—Ä–µ—à–∏—Ç—å¬†`/docs/**` |
| `/v3/api-docs`¬†‚Üí¬†500¬†`ControllerAdviceBean.<init>` | –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å Spring¬†Boot¬†3.5¬†–∏ —Å—Ç–∞—Ä–æ–π¬†springdoc¬†2.6.x¬†‚Üí –æ–±–Ω–æ–≤–∏—Ç—å¬†–¥–æ¬†**2.8.13** |
| Swagger¬†UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç¬†¬´Failed¬†to¬†load¬†API¬†definition¬ª | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `/v3/api-docs`¬†–æ—Ç–¥–∞—ë—Ç¬†200¬†–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è¬†JWT‚Äë—Ñ–∏–ª—å—Ç—Ä–æ–º |
| UI¬†403¬†/¬†401 | –î–æ–±–∞–≤–∏—Ç—å¬†`/docs/**`¬†–∏–ª–∏¬†`/swagger-ui/**`¬†–≤¬†permitAll()¬†–∏ –∏—Å–∫–ª—é—á–∏—Ç—å –∏–∑¬†JWT‚Äë—Ñ–∏–ª—å—Ç—Ä–∞ |

---

## –ê–≤—Ç–æ—Ä

**–û–∂–æ–≥–∏–Ω –¢–∏—Ö–æ–Ω –°–µ—Ä–≥–µ–µ–≤–∏—á**  
_–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ¬†‚Äì¬†Bank¬†REST¬†API_

---

### –°—Ç–∞—Ç—É—Å
**–†–∞–±–æ—á–∞—è —Å–±–æ—Ä–∫–∞** ¬∑ Swagger¬†UI¬†–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è¬†OpenAPI¬†–ø—Ä–æ–≤–µ—Ä–µ–Ω—ã 
